<!DOCTYPE html>
<html>
<head>
    <title>Debug Movement</title>
    <style>
        body { background: #222; color: white; font-family: Arial; padding: 20px; }
        canvas { border: 2px solid white; background: black; }
        #debug { background: #333; padding: 10px; margin: 10px 0; height: 300px; overflow-y: scroll; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Debug Tetris Movement</h1>
    <div id="debug"></div>
    <canvas id="gameCanvas" width="300" height="600"></canvas>
    
    <script type="module">
        const debug = document.getElementById('debug');
        
        function log(message) {
            console.log(message);
            debug.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            debug.scrollTop = debug.scrollHeight;
        }
        
        log('Starting movement debug...');
        
        try {
            const { GameEngine } = await import('./js/gameEngine.js');
            const { GameRenderer } = await import('./js/gameRenderer.js');
            
            const canvas = document.getElementById('gameCanvas');
            const context = canvas.getContext('2d');
            
            const gameEngine = new GameEngine({
                boardWidth: 10,
                boardHeight: 20,
                initialFallSpeed: 2000, // Slower for debugging
                softDropSpeed: 100
            });
            
            const gameRenderer = new GameRenderer(context, context, {
                BOARD_WIDTH: 10,
                BOARD_HEIGHT: 20,
                BLOCK_SIZE: 30
            });
            
            let updateCount = 0;
            
            gameEngine.onGameStateChange = (gameState) => {
                updateCount++;
                log(`Update #${updateCount}: Status=${gameState.status}, Current piece: ${gameState.currentPiece ? gameState.currentPiece.type + ' at (' + gameState.currentPiece.x + ',' + gameState.currentPiece.y + ')' : 'none'}`);
                
                try {
                    gameRenderer.render(gameState);
                } catch (error) {
                    log('Render error: ' + error.message);
                }
            };
            
            log('Starting game engine...');
            gameEngine.start();
            
            // Log game state every 3 seconds
            setInterval(() => {
                const state = gameEngine.getGameState();
                log(`Periodic check: Status=${state.status}, Updates received: ${updateCount}`);
            }, 3000);
            
        } catch (error) {
            log('Error: ' + error.message);
            log('Stack: ' + error.stack);
        }
    </script>
</body>
</html>